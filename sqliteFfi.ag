using sys { String, Blob }

class Sqlite {
    open(fileName str, flags int) ?Sqlite;  // returns this on success
    query(sql str, flags int) Query {
        r = Query;
        _query(r, sql, flags);
        r
    }
    _handle = sys_handle;
    _query(q Query, sql str, flags int);
}
fn afterCopySqlite(c Sqlite) { c._handle := sys_handle; }
fn disposeSqlite(c Sqlite);

class Row{
    intAt(at int) int;
    doubleAt(at int) double;
    stringAt(at int) str;
    blobAt(at int, result Blob);
    _handle = sys_handle;
}
fn afterCopyRow(r Row) { r._handle := sys_handle; }
fn disposeRow(r Row);

class Query {
    +Row;
    setString(at int, val str) this;
    setInt(at int, val int) this;
    setBlob(at int, val int) this;
    execute(onRow(Row)) {
        loop !(_step() ? onRow(this))
    }
    _step() bool;
}
